version: "3.9"

services:
  bun:
    build: .
    container_name: webrtc-bun
    restart: always
    environment:
      PORT: 8080
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
    expose:
      - "8080"
    volumes:
      - /etc/letsencrypt/live/194.32.140.234.sslip.io/fullchain.pem:/app/certs/cert.pem:ro
      - /etc/letsencrypt/live/194.32.140.234.sslip.io/privkey.pem:/app/certs/key.pem:ro

nginx:
  image: nginx:alpine
  container_name: webrtc-nginx
  restart: always
  ports:
    - "80:80"
    - "8443:8443"
  volumes:
    - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    - /etc/letsencrypt/live/194.32.140.234.sslip.io/fullchain.pem:/etc/nginx/certs/cert.pem:ro
    - /etc/letsencrypt/live/194.32.140.234.sslip.io/privkey.pem:/etc/nginx/certs/key.pem:ro
  depends_on:
    - bun
