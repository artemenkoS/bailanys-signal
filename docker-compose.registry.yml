version: "3.9"

services:
  bun:
    image: ${BUN_IMAGE}
    pull_policy: always
    container_name: webrtc-bun
    restart: always
    environment:
      PORT: 8080
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      TURN_URLS: ${TURN_URLS}
      TURN_SECRET: ${TURN_SECRET}
      TURN_TTL_SECONDS: ${TURN_TTL_SECONDS}
      TURN_USER_PREFIX: ${TURN_USER_PREFIX}
    networks:
      - web
    expose:
      - "8080"

  client:
    image: ${CLIENT_IMAGE}
    pull_policy: always
    container_name: bailanys-client
    restart: always
    networks:
      - web
    expose:
      - "80"

  nginx:
    image: nginx:alpine
    container_name: web-nginx
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/proxy.conf:/etc/nginx/conf.d/default.conf:ro
      - /etc/letsencrypt:/etc/letsencrypt:ro
      - ./nginx/www:/var/www/certbot
    depends_on:
      - bun
      - client
    networks:
      - web

networks:
  web:
    driver: bridge
